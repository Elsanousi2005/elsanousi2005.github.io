<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Post 3: Vitis Setup and Testing for PS Ethernet and PS to PL Validation | Mostafa Elsanousi </title> <meta name="author" content="Mostafa Elsanousi"> <meta name="description" content="This post covers the Vitis side of the ZC702 bring up. The goal is to validate Ethernet in two layers so that failures are diagnosable rather than ambiguous."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;500;600;700&amp;family=Source+Serif+4:opsz,wght@8..60,400;600;700&amp;family=JetBrains+Mono:wght@400;500;600&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%A1&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://elsanousi2005.github.io/blog/2026/post-3-vitis-setup-and-testing/"> <script src="/assets/js/theme.js?6d51f2ee9e187382dbb108fd7726ddaf"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Mostafa Elsanousi </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">Resume </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Post 3: Vitis Setup and Testing for PS Ethernet and PS to PL Validation</h1> <p class="post-meta"> Created on January 17, 2026 </p> <p class="post-tags"> <a href="/blog/2026"> <i class="fa-solid fa-calendar fa-sm"></i> 2026 </a>   ·   <a href="/blog/tag/zynq"> <i class="fa-solid fa-hashtag fa-sm"></i> zynq</a>   <a href="/blog/tag/zc702"> <i class="fa-solid fa-hashtag fa-sm"></i> zc702</a>   <a href="/blog/tag/ethernet"> <i class="fa-solid fa-hashtag fa-sm"></i> ethernet</a>   <a href="/blog/tag/lwip"> <i class="fa-solid fa-hashtag fa-sm"></i> lwip</a>   <a href="/blog/tag/axi"> <i class="fa-solid fa-hashtag fa-sm"></i> axi</a>   <a href="/blog/tag/vivado"> <i class="fa-solid fa-hashtag fa-sm"></i> vivado</a>   <a href="/blog/tag/vitis"> <i class="fa-solid fa-hashtag fa-sm"></i> vitis</a>   <a href="/blog/tag/ps-pl"> <i class="fa-solid fa-hashtag fa-sm"></i> ps-pl</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_001.png" alt="Image: image_001.png"></p> <p><strong>Author(s):</strong> Mostafa Elsanousi, <a href="https://github.com/muhammadfarhan720" rel="external nofollow noopener" target="_blank">Muhammad Farhan Azmine</a></p> <p><strong>Publication Date:</strong> 2026-01-17</p> <p><strong>Target Board:</strong> AMD/Xilinx ZC702 (xc7z020 Zynq-7000)<br><strong>Toolchain:</strong> Vivado 2025.1, Vitis 2025.1<br><strong>Keywords:</strong> Zynq, GEM0, Ethernet, MIO, RGMII, lwIP, UDP, AXI, AXI4-Lite, SmartConnect, GPIO</p> <h2 id="code-and-resources">Code and Resources</h2> <p>All project materials for this Ethernet bring-up are in my repository: <a href="https://github.com/Elsanousi2005/zc702-ps-ethernet-udp-gpio-inverter" rel="external nofollow noopener" target="_blank">ZC702 Ethernet Bring-up Repository</a>.</p> <p>It includes the Vivado project (<code class="language-plaintext highlighter-rouge">.xpr</code>), the block design, exported hardware (<code class="language-plaintext highlighter-rouge">.xsa</code>/<code class="language-plaintext highlighter-rouge">.hwh</code>), the Vitis bare-metal sources for both the TCP echo example and the UDP inverter application, plus the host-side Python script used to send UDP test vectors.</p> <p>You can open the hardware project directly in Vivado (File -&gt; Open Project -&gt; select the <code class="language-plaintext highlighter-rouge">.xpr</code>).</p> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_002.png" alt="Image: image_002"></p> <h2 id="1-purpose-and-validation-strategy">1. Purpose and validation strategy</h2> <p>This post covers the Vitis side of the ZC702 bring up. The goal is to validate Ethernet in two layers so that failures are diagnosable rather than ambiguous.</p> <p>The first layer is a known good TCP echo server that exercises only the Processing System network path and lwIP. It provides a baseline that confirms link, IP configuration, and end to end TCP receive and transmit behavior without any dependency on Programmable Logic.</p> <p>The second layer is the project’s UDP inverter service. This validates Ethernet and lwIP UDP, and it also validates PS to PL memory mapped register access by writing to an AXI GPIO output register, passing through a PL inverter datapath, and reading back through an AXI GPIO input register. The application replies to the host with both the original word and the readback word so correctness can be verified in a single transaction.</p> <p>A simple diagnostic rule of thumb is:</p> <p>If TCP works but UDP fails, focus on PS to PL access, PL programming, address map mismatch, or UDP payload handling. If both fail, focus on link, IP configuration, lwIP initialization, or host network setup.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_003.png" alt="Image: image_003"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_004.png" alt="Image: image_004"></p> <h2 id="2-prerequisites-and-test-setup">2. Prerequisites and test setup</h2> <h3 id="21-required-artifacts">2.1. Required Artifacts</h3> <p>Before starting Vitis bring up, ensure you have:</p> <ol> <li>A Vivado exported hardware handoff generated from the implemented design (<code class="language-plaintext highlighter-rouge">.xsa</code>).</li> <li>The corresponding bitstream from the same Vivado build (<code class="language-plaintext highlighter-rouge">.bit</code>).</li> <li>The Vitis application sources for the TCP echo server and the UDP inverter service.</li> <li>A host side testing environment, ideally a Linux PC with netcat, hexdump, and Python 3 available.</li> </ol> <p>A key bring up rule is to treat the XSA and the bitstream as a matched pair from the same implementation result. If you build software against one XSA but program a different bitstream, PS to PL register access can fail even when addresses in software appear correct.</p> <h3 id="22-host-nic-static-ipv4-configuration">2.2. Host NIC Static IPv4 Configuration</h3> <p>For a direct PC to board cable, the host Ethernet interface must be placed on the same IPv4 subnet as the ZC702. In this project, the board uses a static address of <code class="language-plaintext highlighter-rouge">192.168.1.10/24</code>, so a typical host address is <code class="language-plaintext highlighter-rouge">192.168.1.20/24</code> with a <code class="language-plaintext highlighter-rouge">255.255.255.0</code> netmask. A gateway is optional for a direct link and can be left blank.</p> <ol> <li>Open Settings on Ubuntu, then select Network in the left sidebar.</li> <li>Under Wired, identify the Ethernet connection that is physically connected to the ZC702.</li> <li>Click the gear icon next to that connection to open its configuration dialog.</li> </ol> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_005.png" alt="Image: image_005"></p> <ol> <li>Go to the IPv4 tab.</li> <li>Change IPv4 Method from Automatic (DHCP) to Manual.</li> </ol> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_006.png" alt="Image: image_006"></p> <ol> <li>Add an IPv4 address for your host, for example: <ul> <li>Address: <code class="language-plaintext highlighter-rouge">192.168.1.20</code> </li> <li>Netmask: <code class="language-plaintext highlighter-rouge">255.255.255.0</code> </li> <li>Gateway: (optional for direct link, you may leave it blank)</li> </ul> </li> <li>Click Apply, then toggle the Wired connection off and back on if the settings do not take effect immediately.</li> </ol> <h3 id="23-board-hardware-setup-and-link-indicators">2.3. Board Hardware Setup and Link Indicators</h3> <p>Use the following physical setup before launching any application:</p> <ol> <li>Power: Connect the ZC702 barrel jack supply, then set the board power switch to ON.</li> <li>JTAG (program and run): Connect the USB JTAG cable from the ZC702 to the host PC. This is used by Vitis to program the FPGA and launch the ELF.</li> <li>UART (console): Connect the USB UART cable from the ZC702 to the host PC and verify it enumerates as a serial device. This will be used for a 115200 8N1 console.</li> <li>Ethernet (data path): Connect an RJ45 cable from the ZC702 Ethernet port to the host PC’s Ethernet port (or NIC dongle).</li> </ol> <p>After plugging in Ethernet and powering the board, check the RJ45 LEDs. A healthy setup typically shows:</p> <ul> <li>A steady link LED indicating the PHY has established link.</li> <li>A blinking activity LED once traffic occurs (for example, during ping, TCP connect, or UDP packets).</li> <li>If the LEDs stay completely off, treat it as a physical layer issue first: wrong port, bad cable, wrong host interface selected, or the host NIC is disabled.</li> </ul> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_007.png" alt="Image: image_007"></p> <p><em>Figure 2: Board setup showing power, JTAG, UART, and Ethernet status LEDs</em></p> <h2 id="3-vitis-platform-setup-from-the-exported-xsa">3. Vitis platform setup from the exported XSA</h2> <p>This workspace uses two platform components, one associated with the TCP echo baseline and one associated with the UDP inverter application. Keeping the baseline and the custom application separated helps prevent BSP setting conflicts occurring during bring up.</p> <h3 id="31-create-a-platform-component-from-the-exported-xsa">3.1. Create a platform component from the exported XSA</h3> <p>In Vitis Unified IDE:</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><strong>1. Launch Vitis and select a workspace.</strong> <img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_008.png" alt="Image: image_008"></p> <p><strong>2. Create a new Platform Component.</strong></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_009.png" alt="Image: image_009"></p> <p><strong>3. Name your platform file and click “Next”</strong></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_010.png" alt="Image: image_010"></p> <p><strong>4. Choose Hardware Design and browse to the exported XSA from Vivado.</strong></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_011.png" alt="Image: image_011"></p> <p><strong>5. Select the <code class="language-plaintext highlighter-rouge">ps7_cortexa9_0</code> target and choose a standalone domain.</strong></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_012.png" alt="Image: image_012"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><strong>5. Finish the wizard and build the platform.</strong> <img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_013.png" alt="Image: image_013"></p> <h3 id="32-platform-and-board-support-package-configuration-for-lwip-and-dhcp">3.2. Platform and Board Support Package configuration for lwIP and DHCP</h3> <p>Before creating either application, configure the Vitis platform so lwIP is included and DHCP behavior is explicit. This avoids the common bring up failure mode where the application builds and runs, but never obtains an IP address because the network stack configuration is incomplete or waiting on DHCP.</p> <h4 id="1-enable-lwip-lwip220-in-the-platform"><strong>1. Enable lwIP (lwip220) in the platform</strong></h4> <p>A. Open the platform component in Vitis. In the Components view, select the platform and open its settings (<code class="language-plaintext highlighter-rouge">{}vitis-comp.json</code>).</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_014.png" alt="Image: image_014"></p> <p>B. Ensure the <code class="language-plaintext highlighter-rouge">lwip220</code> library is enabled under the standalone domain configuration under the Board Support Package (BSP) so lwIP is actually included in the BSP. Save the change and rebuild the platform so the generated BSP reflects the new library selection.</p> <p>####</p> <p>####</p> <p>####</p> <p>####</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_015.png" alt="Image: image_015"></p> <h4 id="2-make-dhcp-behavior-explicit-in-bsp-settings"><strong>2. Make DHCP behavior explicit in BSP settings</strong></h4> <p>Next, open the BSP settings panel for the same platform. The lwIP DHCP toggles here control what gets generated into <code class="language-plaintext highlighter-rouge">lwipopts.h</code>, which ultimately determines whether lwIP will attempt to request a DHCP lease.</p> <p>For a direct PC-to-board Ethernet connection with no router or DHCP server, DHCP must be disabled. Otherwise the network stack can wait indefinitely for a lease that never arrives.</p> <p>In this project’s platform configuration, set the following to false (if not already set to false by default):</p> <ul> <li><code class="language-plaintext highlighter-rouge">lwip220_dhcp = false</code></li> <li><code class="language-plaintext highlighter-rouge">lwip220_dhcp_debug = false</code></li> <li><code class="language-plaintext highlighter-rouge">lwip220_dhcp_options = false</code></li> <li><code class="language-plaintext highlighter-rouge">lwip220_lwip_dhcp_does_acd_check</code></li> </ul> <p>With DHCP disabled at the platform level, applications can use deterministic static addressing when their code assigns it.</p> <p>If you are connected to a router and want DHCP instead, enable DHCP in the platform by setting the configurations above to true. In that network protocol mode, the board will obtain a dynamic IP on each run and you should read the assigned address from the UART log.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_016.png" alt="Image: image_016"></p> <p>It is worth confirming the console routing in Vitis before building. In the platform view, open <code class="language-plaintext highlighter-rouge">vitis-comp.json</code> and check <code class="language-plaintext highlighter-rouge">standalone_stdin</code> and <code class="language-plaintext highlighter-rouge">standalone_stdout</code> under the standalone OS settings. These should point to <code class="language-plaintext highlighter-rouge">UART1</code>, which is the MIO-mapped UART on the ZC702 used for serial logs. This makes sure all <code class="language-plaintext highlighter-rouge">xil_printf</code> output shows up on the UART terminal.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_017.png" alt="Image: image_017"></p> <h3 id="33-why-two-separate-platform-components-are-recommended">3.3. Why two separate platform components are recommended</h3> <p>This project uses two nearly identical platforms, one for the TCP echo baseline and one for the UDP inverter test. While it is possible to build both applications against a single platform, separating them is a conservative choice for bring-up work because lwIP and BSP settings are platform-scoped.</p> <p>When multiple applications share one platform, changing a lwIP setting for one test silently changes the environment for the other. Separate platforms keep each test’s BSP stable and reproducible, and they make debugging more straightforward when comparing a known good baseline against the full system validation resulting in cleaner and more modular code.</p> <p>Port numbers and protocol behavior are application level details and are covered in the next section when the TCP echo and UDP inverter applications are created and run.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_018.png" alt="Image: image_018"></p> <h2 id="4-section-a-baseline-validation-using-the-lwip-tcp-echo-server">4. Section A: Baseline validation using the lwIP TCP echo server</h2> <h3 id="41-what-the-tcp-echo-server-does">4.1. What the TCP echo server does</h3> <p>The TCP echo server listens on a TCP port and echoes back any bytes received from the host. This validates the PS Ethernet path end to end, including lwIP receive, TCP processing, and lwIP transmit. Because it does not touch PS to PL peripherals, it isolates network bring-up from PL issues.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_019.png" alt="Image: image_019"></p> <h3 id="42-build-and-setup-steps-in-vitis">4.2. Build and setup steps in Vitis</h3> <h2 id="1-create-a-new-application-component-from-an-example-template"><strong>1. Create a new Application Component from an example template</strong></h2> <p>In Vitis, select File -&gt; then select New Example.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_020.png" alt="Image: image_020"></p> <h2 id="2-select-the-template-from-the-example-list-choose-lwip-echo-server-then-click-create-application-component-from-template"> <strong>2. Select the template</strong> From the example list, choose lwIP Echo Server, then click Create Application Component from Template.</h2> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_021.png" alt="Image: image_021"></p> <h2 id="3-name-the-application-and-select-the-platform"><strong>3. Name the application and select the platform</strong></h2> <ul> <li>Enter a non conflicting application name (for example <code class="language-plaintext highlighter-rouge">lwip_echo_server_baseline</code>).</li> <li>When prompted, select the platform component intended for the lwIP echo server baseline test.</li> <li>The application domain will be generated automatically to match the platform domain.</li> <li>Click Finish.</li> </ul> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_022.png" alt="Image: image_022"></p> <h2 id="4-edit-1-choose-the-tcp-listening-port"><strong>4. Edit 1: Choose the TCP listening port</strong></h2> <p>Open <code class="language-plaintext highlighter-rouge">echo.c</code> in the newly created lwIP Echo Server application. The Vitis lwIP echo server template defines the listening port on line 100 as:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">unsigned port = 7;</code> (line 100)</li> </ul> <p>For this project, set the port to <code class="language-plaintext highlighter-rouge">6001</code> instead (for example, <code class="language-plaintext highlighter-rouge">unsigned port = 6001;</code>). Port selection is an application choice. The key requirement is simply that the server port in <code class="language-plaintext highlighter-rouge">echo.c</code> matches the port you use in host testing and, ideally, any corresponding UART banner text you include in your write up.</p> <p>In this tutorial, the baseline TCP validation is performed on port 6001, so all TCP testing commands in this section will target 6001.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_023.png" alt="Image: image_023"></p> <h2 id="5-edit-2-set-a-board-specific-mac-address-recommended-best-practice"><strong>5. Edit 2: Set a board specific MAC address (recommended best practice)</strong></h2> <p>Open <code class="language-plaintext highlighter-rouge">main.c</code> and locate the MAC address definition on line 128. The stock example uses a template MAC address value that often still works in a single board, direct PC to board setup, because there are no other devices competing with the same MAC on that isolated link.</p> <p>Even though it is not strictly required for an isolated test, we still replace the template MAC with a board specific MAC address. This is the correct long term practice for repeatability and reuse. If you later connect the board to a network with other devices or a DHCP server, duplicate MAC addresses can cause subtle failures such as ARP confusion or DHCP lease collisions. Using a unique MAC avoids those hard to debug issues and makes the setup robust across different network environments.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_024.png" alt="Image: image_024"></p> <h2 id="6-build-the-application-to-generate-the-elf"><strong>6. Build the application to generate the ELF.</strong></h2> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_025.png" alt="Image: image_025"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_026.png" alt="Image: image_026"></p> <h2 id="8open-the-uart-serial-monitor-115200-8n1-and-verify-startup-messages"><strong>8.Open the UART Serial Monitor (115200 8N1) and verify startup messages</strong></h2> <p>In Vitis, open Vitis -&gt; Serial Monitor and select the USB UART device for the board. In this project it appears as <code class="language-plaintext highlighter-rouge">/dev/ttyUSB0</code> (Silicon Labs), which you can recognize by the manufacturer string. Set 115200 baud, 8 data bits, no parity, 1 stop bit (<code class="language-plaintext highlighter-rouge">115200 8N1</code>), then open the connection so the terminal is listening. After the terminal is open, run the application in Vitis. The server banner and status prints should then appear in the Serial Monitor output as the program executes.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_027.png" alt="Image: image_027"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_028.png" alt="Image: image_028"></p> <h3 id="43-host-side-test-on-linux">4.3. Host side test on Linux</h3> <p>First confirm basic reachability using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping 192.168.1.10
</code></pre></div></div> <p>Then open a TCP session to the echo server using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-v</span> 192.168.1.10 6001
</code></pre></div></div> <p>Type a short line of text. You should see the same text echoed back by the board.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_029.png" alt="Image: image_029"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_030.png" alt="Image: image_030"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_031.png" alt="Image: image_031"></p> <h3 id="44-what-this-test-proves">4.4. What this test proves</h3> <p>A successful TCP echo session proves that:</p> <ol> <li>The PHY link is up and the MAC is transmitting and receiving frames through GEM0.</li> <li>The board IP configuration is correct for the local network.</li> <li>lwIP is receiving traffic, processing TCP, and transmitting replies correctly.</li> </ol> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_032.png" alt="Image: image_032"></p> <h2 id="5-section-b-full-system-validation-using-the-udp-inverter-application">5. Section B: Full system validation using the UDP inverter application</h2> <h3 id="51-what-the-udp-inverter-service-validates">5.1. What the UDP inverter service validates</h3> <p>The UDP inverter service is the full system test. It validates Ethernet and lwIP UDP, and it validates PS to PL memory mapped register access in a deterministic loop.</p> <p>The host sends exactly 4 bytes representing a 32 bit word W in little endian order. The PS writes W to an AXI GPIO output register. In the PL, the output bus is bitwise inverted. The PS reads the inverted value R from an AXI GPIO input register and replies with 8 bytes containing W followed by R. The expected relationship is R equals bitwise NOT of W.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_033.png" alt="Image: image_033"></p> <h3 id="52-udp-protocol-definition">5.2. UDP protocol definition</h3> <p>UDP port: <code class="language-plaintext highlighter-rouge">5005</code> Request payload: <code class="language-plaintext highlighter-rouge">4</code> bytes, little endian unsigned 32 bit word Response payload: <code class="language-plaintext highlighter-rouge">8</code> bytes, concatenation of W and R, in the same byte ordering Length check behavior: if the request is not exactly <code class="language-plaintext highlighter-rouge">4</code> bytes, the service replies with the ASCII string <code class="language-plaintext highlighter-rouge">BADLEN</code></p> <table style="width: 100%; border-collapse: collapse;"> <thead> <tr> <th style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;"><strong>Message</strong></th> <th style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;"><strong>Direction</strong></th> <th style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;"><strong>Length (bytes)</strong></th> <th style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;"><strong>Payload Format</strong></th> <th style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;"><strong>Notes</strong></th> </tr> </thead> <tbody> <tr> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Request</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Host -&gt; Board</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">4</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">W = 32-bit unsigned little-endian</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Single word command</td> </tr> <tr> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Response</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Board -&gt; Host</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">8</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">W then R (both 32-bit, little-endian)</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">R = ~W</td> </tr> <tr> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Error</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Board -&gt; Host</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">8</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">ASCII "BADLEN"</td> <td style="border: 1px solid #d0d0d0; padding: 8px; text-align: center;">Sent when request length != 4</td> </tr> </tbody> </table> <p>This response format is intentional. Returning both W and R allows the host to validate correctness without maintaining additional state. The host can confirm that the second word equals the bitwise inversion of the first word for each transaction.</p> <h3 id="53-build-and-run-steps-in-vitis">5.3. Build and run steps in Vitis</h3> <h4 id="1-create-a-platform-component-for-the-udp-inverter-import-the-same-xsa-as-in-the-tcp-section-and-ensure-lwip-is-enabled-and-the-bsp-dhcp-choice-is-set-as-intended-for-your-setup">1. Create a platform component for the UDP inverter (import the same XSA as in the TCP section) and ensure lwIP is enabled and the BSP DHCP choice is set as intended for your setup.</h4> <h4 id="2-create-an-application-component-from-your-udp-inverter-sources-and-select-the-udp-platform-component">2. Create an application component from your UDP inverter sources and select the UDP platform component.</h4> <h4 id="3-build-the-application-to-generate-the-elf">3. Build the application to generate the ELF.</h4> <h4 id="4-open-the-serial-monitor-115200-8n1-program-the-fpga-and-run-the-elf-on-ps7_cortexa9_0">4. Open the Serial Monitor (115200 8N1), program the FPGA, and run the ELF on <code class="language-plaintext highlighter-rouge">ps7_cortexa9_0</code>.</h4> <h4 id="5-confirm-on-uart-that-the-banner-prints-and-that-the-service-reports-it-is-listening-on-udp-port-5005">5. Confirm on UART that the banner prints and that the service reports it is listening on UDP port 5005.</h4> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_034.png" alt="Image: image_034"></p> <h3 id="54-host-side-udp-test-python-client">5.4. Host side UDP test (Python client)</h3> <p>Start with a ping to confirm reachability:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping 192.168.1.10
</code></pre></div></div> <p>Option A</p> <p>Open a terminal on the host PC and run the client script from the repository. Expected readback is the bitwise inversion. For example, <code class="language-plaintext highlighter-rouge">0x12345678</code> becomes <code class="language-plaintext highlighter-rouge">0xEDCBA987</code>.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/zc702-ps-ethernet-udp-gpio-inverter/host
python3 host_udp_inverter.py 192.168.1.10 0x12345678
</code></pre></div></div> <p>Option B:</p> <p>We can also test the UDP inverter using netcat with hexdump to see the raw bytes on the wire. This is an optional alternative to the Python client, but it is equally valid for confirming the protocol framing and end-to-end inversion:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nt">-n</span> <span class="nt">-e</span> <span class="s1">'\x78\x56\x34\x12'</span> | nc <span class="nt">-u</span> <span class="nt">-w</span> 3 192.168.1.10 5005 | hexdump <span class="nt">-v</span> <span class="nt">-e</span> <span class="s1">'1/1 "%02x"'</span><span class="p">;</span> <span class="nb">echo</span>
</code></pre></div></div> <p>Although the board replies essentially immediately, nc -u -w 3 keeps the socket open until the timeout expires, so hexdump does not print the bytes until netcat closes. By contrast, a TCP nc session stays interactive and shows echoed data as soon as it arrives, which is why the TCP test feels instant while the UDP one appears slightly delayed.</p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_035.png" alt="Image: image_035"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_036.png" alt="Image: image_036"></p> <p class="img-fluid rounded z-depth-1 d-block post-figure-wide-xl"><img src="/assets/img/posts/post-3-vitis-setup-and-testing/image_037.png" alt="Image: image_037"></p> <h4 id="6-verification-summary">6. Verification Summary</h4> <p>The TCP echo baseline verifies the PS side network stack end to end: GEM0 link, IP configuration, lwIP initialization, and TCP receive and transmit behavior, without involving the PL.</p> <p>The UDP inverter test verifies the full system path: UDP reception, deterministic parsing, AXI Lite memory mapped writes and reads into the PL through AXI GPIO, and correct inversion on the PL datapath.</p> <p>Together, these two tests separate network bring up from PS to PL integration, so failures are localized and the overall bring up process stays repeatable.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/post-2-vivado-setup-bitstream-xsa/">Post 2: Vivado setup, bitstream, and hardware export (XSA)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/post-1-zc702-ps-ethernet-over-mio-and-ps-to-pl-axi-loopback/">Post 1: ZC702 PS Ethernet over MIO and PS to PL AXI Loopback</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © 2026 Mostafa Elsanousi. Built with Jekyll (al-folio). Hosted on GitHub Pages. Photos from Unsplash. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>